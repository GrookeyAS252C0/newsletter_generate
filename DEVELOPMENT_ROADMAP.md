# 日大一中・高メルマガシステム 開発ロードマップ

## 📋 プロジェクト概要
受験生・保護者向けの健康配慮メルマガに学校紹介機能を統合し、「今日初めて読む人」にも「毎日読んでくれる人」にも価値のあるメルマガシステムの構築

## 🎯 実装済み機能（Phase 1完了）

### ✅ 健康アドバイスシステム
- **気圧影響**: 専用データ（pressure_impact_data.json）による科学的アドバイス
- **月齢影響**: LLM活用による柔軟な月相コメント生成（gpt-4o-mini）
- **段階的月齢判定**: 6段階の詳細な月相分析（新月期・三日月期・上弦期・満月期・下弦期・晦期）
- **統合メッセージ**: 重複排除・120文字制限のコンパクト生成
- **寄り添う口調**: 「頑張って」を避けた温かい表現

### ✅ 技術基盤
- **RAGシステム**: 専門知識の効率的活用
- **LLM統合**: GPT-4o-miniによる自然な文章生成
- **エラーハンドリング**: フォールバック機能完備
- **バリエーション管理**: 重複回避アルゴリズム

## 🚀 Phase 2: 学校紹介機能統合（✅ 実装完了）

### 📊 基本学校情報（実装済み）
```python
school_context = """
【学校概要】
- 名称: 日本大学第一中学・高等学校
- 所在地: 東京都墨田区横網（両国・駅近好立地）
- 生徒数: 中学605名、高校1042名
- 通学圏: 下町エリア中心、60分圏内

【教育システム】
- 6年一貫教育（内部進学率90-95%）
- 3段階教育: 基礎期→定着期→入試期
- 日大進学70%超、第一希望学部合格率80%超
- 塾なし対応可能な手厚いサポート

【特色】
- 部活動参加率63%（人生に必要なことを学ぶ場）
- 面倒見の良い指導体制
- 下町の温かさと都心アクセスの両立
"""
```

### 🎨 実装完了機能
- **✅ 動的学校紹介**: 天気・季節・時期連動（12テーマローテーション）
- **✅ 統合メッセージ生成**: LLMによる健康アドバイス + 学校紹介の自然な融合
- **✅ バリエーション管理**: 過去5回分の重複回避システム
- **✅ 文脈連動選択**: 気圧・天候に応じたテーマ重み付け
- **✅ フォールバック機能**: 学校紹介失敗時は健康アドバイスのみ

### 🔧 実装詳細（Phase 2）

#### 新規追加機能
```python
# health_knowledge_rag.py への追加機能
def generate_school_intro_message(self, weather_info, moon_age=None):
    """健康アドバイス + 学校紹介の統合メッセージを生成"""

def _get_school_context(self):
    """日本大学第一中学・高等学校の基本情報を取得"""

def _get_school_intro_themes(self):
    """学校紹介のテーマリスト（12種類）を取得"""

def _select_school_intro_theme(self, weather_context, lunar_context):
    """天気・月齢・履歴を考慮して学校紹介テーマを選択"""

def _create_school_integration_prompt(self, health_message, school_theme, weather_info):
    """学校紹介統合用のプロンプトを作成"""
```

#### 学校紹介テーマ（12種類）
1. **進学実績**: 日大進学率70%超の安心感
2. **立地環境**: 両国駅近の好アクセス
3. **部活動**: 人生に必要なことを学ぶ場
4. **教育システム**: 6年一貫の手厚いサポート
5. **学習環境**: 塾なし対応の無料講習
6. **面倒見**: 提出物管理から進路相談まで
7. **進路選択**: 日大進学と難関私大の両立
8. **学校生活**: 朝8時15分から夕方6時の充実
9. **入試制度**: 複数回受験チャンスあり
10. **通学環境**: 下町エリアからの通いやすさ
11. **校風**: 温かい雰囲気と都心利便性
12. **サポート体制**: 基礎から応用まで段階的指導

#### 文脈連動ロジック
- **雨・低気圧日**: 屋内環境重視（学習環境、面倒見、サポート体制、教育システム）
- **晴・高気圧日**: アクティブ要素重視（部活動、立地環境、学校生活、校風）
- **バリエーション管理**: 過去5回分のテーマ重複を回避

#### weather_service.py での統合
```python
# Phase 2: 学校紹介統合メッセージ生成を試行
school_intro_message = rag_system.generate_school_intro_message(weather_info, moon_age)

# フォールバック: 受験生向けの健康アドバイスのみ
student_message = rag_system.generate_student_focused_message(weather_info, moon_age)
```

## 📈 Phase 3: 体験情報追加（情報収集中）

### 🎯 収集対象情報
#### リアルな学校生活
- [ ] **1日の流れ**: 朝8:15-夕方18:00の具体的スケジュール
- [ ] **授業風景**: 夏期講習・小テスト・面談の実際
- [ ] **年間行事**: 文化祭・体育祭・修学旅行の特色と生徒熱量
- [ ] **部活動**: 練習風景・大会実績・両立パターン

#### サポート体制の実際
- [ ] **進路指導**: 面談頻度・相談内容・決定プロセス
- [ ] **学習支援**: 補習内容・再試験システム・フォロー体制
- [ ] **生活指導**: 提出物管理・生活習慣指導の具体例

### 📝 情報収集方法
- 学校見学時の詳細観察記録
- 説明会での質疑応答内容
- 在校生・保護者インタビュー
- 学校ホームページ・広報資料の詳細分析

## 🌟 Phase 4: 人間味のある情報追加（将来実装）

### 👥 収集予定情報
#### 生徒の生の声
- [ ] **学年別体験談**: 各学年の特色・成長実感・困りごと
- [ ] **部活動体験記**: キャプテン・部員の熱い思い
- [ ] **進路決定ストーリー**: 日大選択・他大挑戦の実体験
- [ ] **友人関係**: クラスの雰囲気・先輩後輩関係

#### 先生の個性・指導スタイル
- [ ] **教員プロフィール**: 久山先生のような個性的な先生方
- [ ] **指導エピソード**: 印象的な授業・進路相談・部活指導
- [ ] **教育理念**: 各先生の生徒への思い・指導方針

#### 保護者の本音
- [ ] **選択理由**: 他校との比較・決め手となった要因
- [ ] **入学後実感**: 期待と現実・満足度・改善希望
- [ ] **成長実感**: 子どもの変化・学校への感謝

## 🎪 Phase 5: 独自性・魅力情報追加（最終段階）

### 🏆 差別化要素
#### 学校文化・個性
- [ ] **校風の具体例**: 下町的温かさの実際のエピソード
- [ ] **伝統・歴史**: 創立からの歩み・地域との関係
- [ ] **独自の取り組み**: 他の日大付属校との違い

#### 成功事例・実績
- [ ] **卒業生活躍**: OB・OGの具体的な活躍事例
- [ ] **進路実現物語**: 夢を叶えた生徒のサクセスストーリー
- [ ] **部活動実績**: 全国大会出場・地域貢献活動

## 🛠 技術実装方針

### システム設計原則
1. **モジュラー構造**: 情報カテゴリ別の独立管理
2. **段階的拡張**: 新情報追加時のシステム影響最小化
3. **品質保証**: エラーハンドリング・フォールバック完備
4. **運用継続性**: メンテナンス負荷軽減

### 実装手順
```python
# 新情報追加時の標準フロー
def update_school_context(new_info_category, new_content):
    """
    1. 既存school_contextに新カテゴリ追加
    2. LLMプロンプト更新
    3. バリエーション管理ルール調整
    4. テスト実行・品質確認
    """
```

## 📊 成功指標・KPI

### 定量指標
- メルマガ開封率向上
- 学校説明会参加申込み増加
- 問い合わせ件数増加
- メッセージバリエーション数

### 定性指標
- 読者満足度（アンケート）
- 初見読者の理解度
- 継続読者の飽きなさ
- 学校の魅力伝達度

## 🗓 開発スケジュール

### 短期（1-2週間）
- [x] Phase 2基本学校紹介機能実装
- [x] 文脈統合ロジック完成
- [x] 初期運用開始

### 中期（1-3ヶ月）
- [ ] Phase 3体験情報収集・追加
- [ ] バリエーション拡大
- [ ] 運用データ分析・改善

### 長期（3-6ヶ月）
- [ ] Phase 4-5高度な魅力情報追加
- [ ] システム最適化
- [ ] 完成版運用

## 💡 今後の改善アイデア

### 技術的拡張
- 読者属性別パーソナライゼーション
- 季節イベント連動型メッセージ
- 画像・動画コンテンツとの連携
- SNS連携・口コミ拡散機能

### コンテンツ拡張
- 他部門（入試・進路・部活）との連携
- リアルタイム学校情報更新
- 卒業生ネットワーク活用
- 地域コミュニティとの連携

---

## 📝 更新履歴
- 2025-07-26: 初版作成（Phase 1完了時点）
- 2025-07-26: Phase 2実装完了（学校紹介統合機能）

### Phase 2 実装内容詳細（2025-07-26）
#### 追加ファイル機能
- **health_knowledge_rag.py**: 
  - `generate_school_intro_message()`: メイン統合機能
  - `_get_school_context()`: 学校基本情報（800行のコンテキスト）
  - `_get_school_intro_themes()`: 12種類のテーマ管理
  - `_select_school_intro_theme()`: 文脈連動テーマ選択
  - `_create_school_integration_prompt()`: LLM統合プロンプト生成
  - `school_intro_history`: バリエーション履歴管理
  
- **weather_service.py**:
  - Phase 2優先実行ロジック追加
  - 学校紹介統合→健康アドバイスのみ→従来RAGの3段階フォールバック

#### 実現された機能
1. **動的学校紹介**: 12テーマの天候連動ローテーション
2. **重複回避**: 過去5回分のテーマ履歴管理
3. **自然な統合**: LLMによる健康アドバイス+学校紹介の融合
4. **文脈認識**: 気圧・天候状況に応じたテーマ重み付け
5. **堅牢性**: 3段階フォールバック機能

#### メッセージ例
```
今日は低気圧の影響で体調管理が重要です。月齢15日の満月期でもあり、
睡眠の質に注意してお過ごしください。

ところで、日大一中・高では塾なし対応の無料講習制度があり、
基礎学力到達度テストも学校授業だけで十分な成績が取れるよう
手厚くサポートしています。受験生の皆様も安心してお過ごしください。
```

- 今後の更新: 各Phase実装時に詳細追記予定

## 📞 参考情報
- 実装ファイル: health_knowledge_rag.py, weather_service.py
- データファイル: pressure_impact_data.json, lunar_impact_data.json
- 学校情報源: 20250725ふらっと学校説明会文字起こし.txt

---
*このファイルは開発の進行に合わせて継続的に更新されます*